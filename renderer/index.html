<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crystal Chat</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="../node_modules/golden-layout/dist/css/goldenlayout-base.css" />
    <link rel="stylesheet" href="../node_modules/golden-layout/dist/css/themes/goldenlayout-dark-theme.css" />
  </head>
  <body>
    <div id="app" class="dock-app">
      <div id="dock-root" class="dock-root"></div>
      <div id="view-staging" class="view-staging">
        <aside class="sidebar" data-view-id="sidebar">
          <div class="sidebar-header">
            <button id="new-chat" class="button button-ghost full-width">+ New chat</button>
          </div>
          <div class="sidebar-search">
            <input id="chat-search-input" class="sidebar-search-input" type="text" placeholder="Search chats..." />
          </div>
          <div class="pinned-group">
            <button id="pinned-btn" class="button button-ghost full-width">
              <span class="icon-text">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 17.27l-5.18 2.73 1-5.85L3.64 9.24l5.9-.86L12 3l2.46 5.38 5.9.86-4.18 4.91 1 5.85L12 17.27Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                Pinned chats
              </span>
              <span class="dropdown-chevron" aria-hidden="true">▸</span>
            </button>
            <div id="pinned-dropdown" class="pinned-dropdown hidden">
              <div id="pinned-dropdown-list" class="pinned-dropdown-list"></div>
            </div>
          </div>
          <div id="chat-list" class="chat-list"></div>
        </aside>
        <main class="chat-area" data-view-id="chat">
          <div id="confirm-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
          <div class="modal">
            <div id="confirm-title" class="modal-title">Confirm</div>
            <div id="confirm-message" class="modal-message"></div>
            <div class="modal-actions">
              <button id="confirm-cancel" class="button button-ghost">Cancel</button>
              <button id="confirm-ok" class="button button-ghost danger">Delete permanently</button>
            </div>
          </div>
        </div>
          <div id="memory-edit-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="memory-edit-title">
          <div class="modal">
            <div id="memory-edit-title" class="modal-title">Edit memory</div>
            <textarea id="memory-edit-input" class="memory-edit-input" rows="5"></textarea>
            <div class="modal-actions">
              <button id="memory-edit-cancel" class="button button-ghost">Cancel</button>
              <button id="memory-edit-save" class="button button-ghost">Save</button>
            </div>
          </div>
        </div>
          <div id="setup-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="setup-title">
          <div class="modal">
            <div id="setup-title" class="modal-title">Setting up Ollama</div>
            <div id="setup-message" class="modal-message"></div>
            <div class="setup-progress">
              <div class="setup-progress-top">
                <div id="setup-progress-label" class="setup-progress-label"></div>
                <div id="setup-progress-percent" class="setup-progress-percent"></div>
              </div>
              <div class="setup-progress-bar">
                <div id="setup-progress-bar-fill" class="setup-progress-bar-fill"></div>
              </div>
              <div id="setup-steps" class="setup-steps" aria-label="Setup steps"></div>
            </div>
            <div class="modal-actions">
              <button id="setup-retry" class="button button-ghost">Retry</button>
              <button id="setup-close" class="button button-ghost">Close</button>
            </div>
          </div>
        </div>
          <header id="chat-header" class="chat-header">
          <div class="chat-header-left">
            <div id="chat-header-title" class="chat-header-title">New chat</div>
            <div id="chat-header-tokens" class="chat-header-meta">0 tokens</div>
          </div>
          <div class="chat-header-right">
            <button
              id="chat-header-tools-btn"
              type="button"
              class="chat-header-tools-btn"
              aria-label="Chat controls"
              aria-haspopup="dialog"
              aria-expanded="false"
            >
              <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M12 5.5C12 6.88071 10.8807 8 9.5 8C8.11929 8 7 6.88071 7 5.5M12 5.5C12 4.11929 10.8807 3 9.5 3C8.11929 3 7 4.11929 7 5.5M12 5.5H21M7 5.5H3M19 12C19 13.3807 17.8807 14.5 16.5 14.5C15.1193 14.5 14 13.3807 14 12M19 12C19 10.6193 17.8807 9.5 16.5 9.5C15.1193 9.5 14 10.6193 14 12M19 12H21M14 12H3M10 18.5C10 19.8807 8.88071 21 7.5 21C6.11929 21 5 19.8807 5 18.5M10 18.5C10 17.1193 8.88071 16 7.5 16C6.11929 16 5 17.1193 5 18.5M10 18.5H21M5 18.5H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div id="chat-header-tools-popover" class="chat-header-tools-popover hidden" role="dialog" aria-label="Chat controls">
              <div class="prompt-tools-row">
                <label class="prompt-tools-label" for="text-size-slider">Text size</label>
                <div class="prompt-tools-slider-wrap">
                  <input id="text-size-slider" class="prompt-tools-slider" type="range" min="0.85" max="1.25" step="0.01" />
                  <div id="text-size-value" class="prompt-tools-value">1.00</div>
                </div>
              </div>
              <div class="prompt-tools-row">
                <div class="prompt-tools-label">
                  <span class="pin-chat-label-wrap">
                    <svg class="icon" viewBox="0 0 24 24" width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="M4 8V12C4 16.4183 7.58172 20 12 20V20C16.4183 20 20 16.4183 20 12V8M4 8V5C4 4.44772 4.44772 4 5 4H8C8.55228 4 9 4.44772 9 5V8M4 8H9M9 8V12C9 13.6569 10.3431 15 12 15V15C13.6569 15 15 13.6569 15 12V8M15 8V5C15 4.44772 15.4477 4 16 4H19C19.5523 4 20 4.44772 20 5V8M15 8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Magnetic scroll</span>
                  </span>
                </div>
                <div id="magnetic-scroll-toggle"></div>
              </div>
              <div class="prompt-tools-row">
                <div class="prompt-tools-label">
                  <span class="pin-chat-label-wrap">
                    <svg class="icon" viewBox="0 0 24 24" width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                      <path d="M12 17.27l-5.18 2.73 1-5.85L3.64 9.24l5.9-.86L12 3l2.46 5.38 5.9.86-4.18 4.91 1 5.85L12 17.27Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    </svg>
                    <span>Pin chat</span>
                  </span>
                </div>
                <div id="pin-chat-toggle" class="pin-chat-toggle"></div>
              </div>
            </div>
          </div>
        </header>
          <section id="messages" class="messages">
          <div id="typing-indicator" class="typing chat-typing hidden">
            <div class="spinner"></div>
            <span id="typing-indicator-label">Waiting for response...</span>
          </div>
        </section>
          <form id="prompt-form" class="prompt-form">
          <div id="error" class="error hidden"></div>
          <div id="prompt-attachments" class="prompt-attachments hidden" aria-label="Attachments"></div>
          <div class="input-shell">
            <div class="prompt-tools">
              <button id="prompt-insert-btn" type="button" class="prompt-tools-btn prompt-insert-btn" aria-label="Insert" aria-haspopup="dialog" aria-expanded="false">
                <span class="prompt-insert-plus" aria-hidden="true">+</span>
              </button>

              <button id="prompt-tools-btn" type="button" class="prompt-tools-btn" aria-label="Chat settings" aria-haspopup="dialog" aria-expanded="false">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M12 5.5C12 6.88071 10.8807 8 9.5 8C8.11929 8 7 6.88071 7 5.5M12 5.5C12 4.11929 10.8807 3 9.5 3C8.11929 3 7 4.11929 7 5.5M12 5.5H21M7 5.5H3M19 12C19 13.3807 17.8807 14.5 16.5 14.5C15.1193 14.5 14 13.3807 14 12M19 12C19 10.6193 17.8807 9.5 16.5 9.5C15.1193 9.5 14 10.6193 14 12M19 12H21M14 12H3M10 18.5C10 19.8807 8.88071 21 7.5 21C6.11929 21 5 19.88071 5 18.5M10 18.5C10 17.1193 8.88071 16 7.5 16C6.11929 16 5 17.1193 5 18.5M10 18.5H21M5 18.5H3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>

              <div id="prompt-insert-popover" class="prompt-insert-popover hidden" role="dialog" aria-label="Insert">
                <button id="prompt-insert-text-btn" type="button" class="prompt-insert-item">
                  <svg class="prompt-insert-item-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M8 3h8l4 4v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M16 3v4h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 13h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M9 17h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span>Insert text file</span>
                </button>
                <button id="prompt-insert-image-btn" type="button" class="prompt-insert-item">
                  <svg class="prompt-insert-item-icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M7 15l3-3 3 3 2-2 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 10h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                  <span>Insert image</span>
                </button>
              </div>

              <input id="prompt-insert-text-input" class="hidden" type="file" accept="text/*,.md,.txt,.json,.csv,.js,.ts,.py,.html,.css,.yaml,.yml" />
              <input id="prompt-insert-image-input" class="hidden" type="file" accept="image/*" />

              <div id="prompt-tools-popover" class="prompt-tools-popover hidden" role="dialog" aria-label="Chat settings">
                <div class="prompt-tools-row">
                  <label class="prompt-tools-label" for="model-select">Model</label>
                  <div id="model-dropdown" class="prompt-tools-dropdown" aria-label="Model"></div>
                </div>
                <div class="prompt-tools-row">
                  <label class="prompt-tools-label" for="creativity-slider">Creativity</label>
                  <div class="prompt-tools-slider-wrap">
                    <input id="creativity-slider" class="prompt-tools-slider" type="range" min="0" max="2" step="0.05" />
                    <div id="creativity-value" class="prompt-tools-value">1.00</div>
                  </div>
                </div>
                <div class="prompt-tools-row">
                  <label class="prompt-tools-label" for="system-prompt">System prompt</label>
                  <textarea id="system-prompt" class="prompt-tools-textarea" rows="2" placeholder="Optional instructions for the assistant..."></textarea>
                </div>
                <div class="prompt-tools-row">
                  <div class="prompt-tools-label">Internet access</div>
                  <div id="enable-internet-toggle"></div>
                </div>
                <div class="prompt-tools-row">
                  <div class="prompt-tools-label">Update memory</div>
                  <div id="update-memory-toggle"></div>
                </div>
                <div id="model-install" class="prompt-tools-install hidden" aria-live="polite">
                  <div class="prompt-tools-install-top">
                    <div id="model-install-label" class="prompt-tools-install-label">Downloading…</div>
                    <div id="model-install-percent" class="prompt-tools-install-percent">0%</div>
                  </div>
                  <div class="prompt-tools-install-bar">
                    <div id="model-install-bar-fill" class="prompt-tools-install-bar-fill"></div>
                  </div>
                </div>
              </div>
            </div>
            <textarea
              id="prompt-input"
              class="prompt-input"
              placeholder="Type your message..."
              rows="1"
            ></textarea>
            <button id="send-btn" type="submit" class="send-button" aria-label="Send">
              <span>➤</span>
            </button>
          </div>
          </form>
        </main>

        <section id="memories-view" class="memories-view hidden" data-view-id="memories">
          <div class="memories-header">
            <div class="memories-title">
              <span class="icon-text">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4 7a3 3 0 0 1 3-3h7a3 3 0 0 1 3 3v11a2 2 0 0 1-2 2H7a3 3 0 0 1-3-3V7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M7 8h7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 12h7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M7 16h5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Memories
              </span>
            </div>
          </div>
          <div class="memories-add">
            <input id="memories-add-input" class="memories-add-input" type="text" placeholder="Add a new memory..." />
            <button id="memories-add-btn" class="button button-ghost">Add</button>
          </div>
          <div class="memories-search">
            <input id="memories-search-input" class="memories-search-input" type="text" placeholder="Search memories..." />
          </div>
          <div id="memories-list" class="memories-list"></div>
        </section>

        <section id="settings-view" class="settings-view hidden" data-view-id="settings">
          <div class="settings-header">
            <div class="settings-title">
              <span class="icon-text">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M20.3499 8.92293L19.9837 8.7192C19.9269 8.68756 19.8989 8.67169 19.8714 8.65524C19.5983 8.49165 19.3682 8.26564 19.2002 7.99523C19.1833 7.96802 19.1674 7.93949 19.1348 7.8831C19.1023 7.82677 19.0858 7.79823 19.0706 7.76998C18.92 7.48866 18.8385 7.17515 18.8336 6.85606C18.8331 6.82398 18.8332 6.79121 18.8343 6.72604L18.8415 6.30078C18.8529 5.62025 18.8587 5.27894 18.763 4.97262C18.6781 4.70053 18.536 4.44993 18.3462 4.23725C18.1317 3.99685 17.8347 3.82534 17.2402 3.48276L16.7464 3.1982C16.1536 2.85658 15.8571 2.68571 15.5423 2.62057C15.2639 2.56294 14.9765 2.56561 14.6991 2.62789C14.3859 2.69819 14.0931 2.87351 13.5079 3.22396L13.5045 3.22555L13.1507 3.43741C13.0948 3.47091 13.0665 3.48779 13.0384 3.50338C12.7601 3.6581 12.4495 3.74365 12.1312 3.75387C12.0992 3.7549 12.0665 3.7549 12.0013 3.7549C11.9365 3.7549 11.9024 3.7549 11.8704 3.75387C11.5515 3.74361 11.2402 3.65759 10.9615 3.50224C10.9334 3.48658 10.9056 3.46956 10.8496 3.4359L10.4935 3.22213C9.90422 2.86836 9.60915 2.69121 9.29427 2.62057C9.0157 2.55807 8.72737 2.55634 8.44791 2.61471C8.13236 2.68062 7.83577 2.85276 7.24258 3.19703L7.23994 3.1982L6.75228 3.48124L6.74688 3.48454C6.15904 3.82572 5.86441 3.99672 5.6517 4.23614C5.46294 4.4486 5.32185 4.69881 5.2374 4.97018C5.14194 5.27691 5.14703 5.61896 5.15853 6.3027L5.16568 6.72736C5.16676 6.79166 5.16864 6.82362 5.16817 6.85525C5.16343 7.17499 5.08086 7.48914 4.92974 7.77096C4.9148 7.79883 4.8987 7.8267 4.86654 7.88237C4.83436 7.93809 4.81877 7.96579 4.80209 7.99268C4.63336 8.26452 4.40214 8.49186 4.12733 8.65572C4.10015 8.67193 4.0715 8.68752 4.01521 8.71871L3.65365 8.91908C3.05208 9.25245 2.75137 9.41928 2.53256 9.65669C2.33898 9.86672 2.19275 10.1158 2.10349 10.3872C2.00259 10.6939 2.00267 11.0378 2.00424 11.7255L2.00551 12.2877C2.00706 12.9708 2.00919 13.3122 2.11032 13.6168C2.19979 13.8863 2.34495 14.134 2.53744 14.3427C2.75502 14.5787 3.05274 14.7445 3.64974 15.0766L4.00808 15.276C4.06907 15.3099 4.09976 15.3266 4.12917 15.3444C4.40148 15.5083 4.63089 15.735 4.79818 16.0053C4.81625 16.0345 4.8336 16.0648 4.8683 16.1255C4.90256 16.1853 4.92009 16.2152 4.93594 16.2452C5.08261 16.5229 5.16114 16.8315 5.16649 17.1455C5.16707 17.1794 5.16658 17.2137 5.16541 17.2827L5.15853 17.6902C5.14695 18.3763 5.1419 18.7197 5.23792 19.0273C5.32287 19.2994 5.46484 19.55 5.65463 19.7627C5.86915 20.0031 6.16655 20.1745 6.76107 20.5171L7.25478 20.8015C7.84763 21.1432 8.14395 21.3138 8.45869 21.379C8.73714 21.4366 9.02464 21.4344 9.30209 21.3721C9.61567 21.3017 9.90948 21.1258 10.4964 20.7743L10.8502 20.5625C10.9062 20.5289 10.9346 20.5121 10.9626 20.4965C11.2409 20.3418 11.5512 20.2558 11.8695 20.2456C11.9015 20.2446 11.9342 20.2446 11.9994 20.2446C12.0648 20.2446 12.0974 20.2446 12.1295 20.2456C12.4484 20.2559 12.7607 20.3422 13.0394 20.4975C13.0639 20.5112 13.0885 20.526 13.1316 20.5519L13.5078 20.7777C14.0971 21.1315 14.3916 21.3081 14.7065 21.3788C14.985 21.4413 15.2736 21.4438 15.5531 21.3855C15.8685 21.3196 16.1657 21.1471 16.7586 20.803L17.2536 20.5157C17.8418 20.1743 18.1367 20.0031 18.3495 19.7636C18.5383 19.5512 18.6796 19.3011 18.764 19.0297C18.8588 18.7252 18.8531 18.3858 18.8417 17.7119L18.8343 17.2724C18.8332 17.2081 18.8331 17.1761 18.8336 17.1445C18.8383 16.8247 18.9195 16.5104 19.0706 16.2286C19.0856 16.2007 19.1018 16.1726 19.1338 16.1171C19.166 16.0615 19.1827 16.0337 19.1994 16.0068C19.3681 15.7349 19.5995 15.5074 19.8744 15.3435C19.9012 15.3275 19.9289 15.3122 19.9838 15.2818L19.9857 15.2809L20.3472 15.0805C20.9488 14.7472 21.2501 14.5801 21.4689 14.3427C21.6625 14.1327 21.8085 13.8839 21.8978 13.6126C21.9981 13.3077 21.9973 12.9658 21.9958 12.2861L21.9945 11.7119C21.9929 11.0287 21.9921 10.6874 21.891 10.3828C21.8015 10.1133 21.6555 9.86561 21.463 9.65685C21.2457 9.42111 20.9475 9.25526 20.3517 8.92378L20.3499 8.92293Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M8.00033 12C8.00033 14.2091 9.79119 16 12.0003 16C14.2095 16 16.0003 14.2091 16.0003 12C16.0003 9.79082 14.2095 7.99996 12.0003 7.99996C9.79119 7.99996 8.00033 9.79082 8.00033 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Settings
              </span>
            </div>
          </div>
          <div class="settings-content">
            <div class="settings-row">
              <div class="settings-label">Theme</div>
              <div id="theme-segment" class="settings-segment" role="group" aria-label="Theme">
                <button id="theme-system-btn" type="button" class="settings-segment-btn" data-theme="system">System</button>
                <button id="theme-dark-btn" type="button" class="settings-segment-btn" data-theme="dark">Dark</button>
                <button id="theme-light-btn" type="button" class="settings-segment-btn" data-theme="light">Light</button>
              </div>
            </div>
            <div class="settings-row">
              <div class="settings-label">Accent color</div>
              <div id="accent-swatches" class="accent-swatches" role="group" aria-label="Accent color">
                <button id="accent-swatch-blue" type="button" class="accent-swatch" data-accent="#7fc9ff" aria-label="Light blue" style="--swatch:#7fc9ff"></button>
                <button id="accent-swatch-purple" type="button" class="accent-swatch" data-accent="#a78bfa" aria-label="Purple" style="--swatch:#a78bfa"></button>
                <button id="accent-swatch-green" type="button" class="accent-swatch" data-accent="#34d399" aria-label="Green" style="--swatch:#34d399"></button>
                <button id="accent-swatch-pink" type="button" class="accent-swatch" data-accent="#fb7185" aria-label="Pink" style="--swatch:#fb7185"></button>
                <button id="accent-swatch-amber" type="button" class="accent-swatch" data-accent="#fbbf24" aria-label="Amber" style="--swatch:#fbbf24"></button>
              </div>
            </div>
          </div>
        </section>

        <section id="trash-view" class="trash-view hidden" data-view-id="trash">
          <div class="trash-header">
            <div class="trash-title">
              <span class="icon-text">
                <svg class="icon" viewBox="0 0 24 24" width="16" height="16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M4 7h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M10 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M6 7l1 14h10l1-14" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M9 7V4h6v3" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                Trash
              </span>
            </div>
            <div class="trash-actions">
              <button id="trash-restore-all" class="button button-ghost">Restore all</button>
              <button id="trash-delete-all" class="button button-ghost danger">Delete all</button>
            </div>
          </div>
          <div class="trash-note">Chats in Trash are permanently deleted after 30 days.</div>
          <div class="trash-search">
            <input id="trash-search-input" class="trash-search-input" type="text" placeholder="Search trash..." />
          </div>
          <div id="trash-list" class="trash-list"></div>
        </section>
      </div>
    </div>
    <script src="vendor/golden-layout.bundle.js"></script>
    <script src="../node_modules/marked/marked.min.js"></script>
    <script type="module" src="renderer.js"></script>
  </body>
</html>
